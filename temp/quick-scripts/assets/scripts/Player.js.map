{"version":3,"sources":["Player.js"],"names":["cc","Class","extends","Component","properties","height","jumpHeight","jumpDuration","accel","squashDuration","maxMoveSpeed","rise_jumpHeight","rise_jumpDuration","rise_accel","sur","default","type","Label","playerJumpDurationValue","playerAccelValue","player_sur","player_jumpDuration","player_accel","canAttrAudio","AudioClip","cannotAttrAudio","jumpAudio","jumpActionArray","switchJumpStyleAudio","jumpInterval","jumpStyleIndex","jumpStylesLength","jumpStyleDisplay","onLoad","enabled","minPosX","node","parent","width","maxPosX","initInput","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","touchReceiver","Canvas","instance","onTouchStart","onTouchEnd","initAttr","upgrade","canAddAttr","canSubAttr","playAttrAudio","bool","console","log","audioEngine","playEffect","updatePlayerAttr","string","addPlayerJumpDuration","subPlayerJumpDuration","addPlayerAccel","subPlayerAccel","getJumpStyles","r","styleKeys","styleValues","jumping","jumpStyles","length","jumpUp","moveBy","v2","easing","jumpDown","squash","scaleTo","stretch","scaleBack","callback","callFunc","playJumpSound","runAction","repeat","sequence","game","getComponent","thisJumpGetScore","scoreKeeper","readyJump","t","setTimeout","getCenterPos","centerPos","x","y","startMoveAt","xSpeed","accLeft","accRight","setPosition","stopMove","stopAllActions","clearInterval","event","keyCode","macro","KEY","a","d","w","switchJumpStyle","s","touchLoc","getLocation","winSize","changeJumpStyle","onDestroy","off","update","dt","Math","abs","gameLevel"],"mappings":"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","file":"Player.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\n    extends: cc.Component,\n    \n    properties: {\n        height: 0, //初始高度\n\n        jumpHeight: 150, // 主角跳跃高度\n        jumpDuration: 0.3, // 主角跳跃持续时间\n        accel: 250, // 加速度\n        squashDuration: 0.05, // 辅助形变动作时间\n        maxMoveSpeed: 3000, // 最大移动速度\n        rise_jumpHeight:1.1,\n        rise_jumpDuration:0.001, \n        rise_accel:8,\n        sur:{\n            default:null,\n            type:cc.Label\n        },\n        playerJumpDurationValue:{\n            default:null,\n            type:cc.Label\n        },\n        playerAccelValue:{\n            default:null,\n            type:cc.Label\n        },\n        player_sur:0,\n        player_jumpDuration:5,\n        player_accel:5,\n\n        // attrSucc:false,  //是否成功修改属性\n        canAttrAudio:{\n            default:null,\n            type:cc.AudioClip\n        },\n        cannotAttrAudio:{\n            default:null,\n            type:cc.AudioClip\n        },\n        // 跳跃音效资源\n        jumpAudio: {\n            default: null,\n            type: cc.AudioClip\n        },\n        jumpActionArray:[],\n        switchJumpStyleAudio: {\n            default: null,\n            type: cc.AudioClip\n        },\n        jumpInterval:null,\n        jumpStyleIndex:0,\n        jumpStylesLength:0,\n        // jumpStyle label 的引用\n        jumpStyleDisplay: {\n            default: null,\n            type: cc.Label\n        },\n    },\n\n    onLoad: function() {\n        this.enabled = false;\n        // screen boundaries\n        this.minPosX = -this.node.parent.width/2;\n        this.maxPosX = this.node.parent.width/2;\n\n        this.initInput();\n    },\n\n    initInput:function(){\n        // 初始化键盘输入监听\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n\n        // 手机触摸屏\n        var touchReceiver = cc.Canvas.instance.node;\n        touchReceiver.on('touchstart', this.onTouchStart, this);\n        touchReceiver.on('touchend', this.onTouchEnd, this); \n    },\n\n    initAttr:function(){\n        this.height=0;\n        this.jumpHeight=150;\n        this.jumpDuration=0.3;\n        this.accel=250;\n    },        \n    upgrade: function(){\n        this.jumpHeight += (this.rise_jumpHeight);\n        this.jumpDuration += this.rise_jumpDuration * (10 + this.player_jumpDuration) / 15;\n        this.accel += this.rise_accel * (10 + this.player_accel) / 15;\n    },\n    canAddAttr(){\n        if(this.player_sur < 1){\n            return false;\n        }else{\n            this.player_sur--;\n            return true;\n        }\n    },\n    canSubAttr(){\n        if(this.player_sur > 9){\n            return false;   \n        }else{\n            this.player_sur++;\n            return true;\n        }\n    },\n    playAttrAudio(bool){\n        console.log(bool)\n        cc.audioEngine.playEffect(this[bool?'canAttrAudio':'cannotAttrAudio'], false);\n        return bool;\n    },\n    updatePlayerAttr(){\n        this.sur.string = '剩余点数：' + this.player_sur;\n        this.playerJumpDurationValue.string = this.player_jumpDuration;\n        this.playerAccelValue.string = this.player_accel;\n    },\n    addPlayerJumpDuration(){\n        if(this.playAttrAudio(this.player_jumpDuration<10&&this.canAddAttr())){\n            this.player_jumpDuration++;   \n            this.updatePlayerAttr();\n        }\n    },\n    subPlayerJumpDuration(){\n        if(this.playAttrAudio(this.player_jumpDuration>0&&this.canSubAttr())){\n            this.player_jumpDuration--;\n            this.updatePlayerAttr();\n        }\n    },\n    addPlayerAccel(){\n        if(this.playAttrAudio(this.player_accel<10&&this.canAddAttr())){\n            this.player_accel++;\n            this.updatePlayerAttr();\n        }\n    },\n    subPlayerAccel(){\n        if(this.playAttrAudio(this.player_accel>0&&this.canSubAttr())){\n            this.player_accel--;   \n            this.updatePlayerAttr();\n        }\n    },\n\n\n    getJumpStyles: function(r){\n\n        let styleKeys = [\n            // '起跳'\n            '正常',\n            '漂浮',\n            // '弹簧',\n            // '震动',\n            '二段',\n            '轻功',\n            '滞空'\n            // '悬空',\n            // '和谐',\n            \n        ];\n        let styleValues = [\n            // ['easeExponentialOut','easeExponentialIn'] //起跳\n            ['easeCubicActionOut','easeCubicActionIn']  //正常\n            ,['easeSineOut','easeSineIn'] //漂浮\n            // ,['easeElasticOut','easeElasticIn'] //弹簧\n            // ,['easeBounceOut','easeBounceIn'] //震动\n            ,['easeBackOut','easeBackIn'] //二段\n            ,['easeQuadraticActionOut','easeQuadraticActionIn']  //轻功\n            ,['easeQuarticActionOut','easeQuarticActionIn'] //滞空\n            // ,['easeQuinticActionOut','easeQuinticActionIn'] //悬空\n            // ,['easeCircleActionOut','easeCircleActionIn'] //和谐\n        ];\n\n        return r==='key'?styleKeys:styleValues;\n    },\n\n\tjumping: function(){\n\n        let jumpStyles = this.getJumpStyles();\n        this.jumpStylesLength = jumpStyles.length;\n\n        // 上升\n        var jumpUp = cc.moveBy(this.jumpDuration, cc.v2(0, this.jumpHeight)).easing(cc[jumpStyles[this.jumpStyleIndex][0]]());\n        // 下落\n        var jumpDown = cc.moveBy(this.jumpDuration, cc.v2(0, -this.jumpHeight)).easing(cc[jumpStyles[this.jumpStyleIndex][1]]());\n\n        // 形变\n        var squash = cc.scaleTo(this.squashDuration, 1, 0.6);\n        var stretch = cc.scaleTo(this.squashDuration, 1, 1.2);\n        var scaleBack = cc.scaleTo(this.squashDuration, 1, 1);\n\n        // 添加一个回调函数，用于在动作结束时调用我们定义的其他方法\n        var callback = cc.callFunc(this.playJumpSound, this);\n\n        this.node.runAction(cc.repeat(cc.sequence(squash, stretch, jumpUp, scaleBack, jumpDown, callback),1));\n        if(this.enabled){\n\t\t\tlet game = this.node.parent.getComponent('Game');\n\t\t\tif(!game.thisJumpGetScore){\n\t\t\t\tgame.scoreKeeper = 1;\n\t\t\t}\n\t\t\tgame.thisJumpGetScore = false;\n        \tthis.readyJump();\n        }\n    },\n\n    readyJump: function () {\n\t\tlet t = this;\n\t\tsetTimeout(function(){\n\t\t\tif(t.enabled) t.jumping();\n\t\t},t.jumpDuration*2000+t.squashDuration*3000);\n    },\n\n    playJumpSound: function () {\n        // 调用声音引擎播放声音\n        cc.audioEngine.playEffect(this.jumpAudio, false);\n    },\n\n    getCenterPos: function () {\n        var centerPos = cc.v2(this.node.x, this.node.y + this.node.height/2);\n        return centerPos;\n    },\n\n    startMoveAt: function (x,y) {\n        this.enabled = true;\n        this.xSpeed = 0; // 主角当前水平方向速度\n        this.accLeft = false;  // 加速度方向开关\n        this.accRight = false;\n        this.initAttr();\n        this.readyJump();\n        this.node.setPosition(x,y);\n    },\n\n    stopMove: function () {\n        this.enabled = false;\n        this.node.stopAllActions();\n        clearInterval(this.jumpInterval);\n    },\n\n    onKeyDown (event) {\n        // set a flag when key pressed\n        switch(event.keyCode) {\n            case cc.macro.KEY.a:\n                this.accLeft = true;\n                break;\n            case cc.macro.KEY.d:\n                this.accRight = true;\n                break;\n            case cc.macro.KEY.w:\n                this.switchJumpStyle(true);\n                break;\n            case cc.macro.KEY.s:\n                this.switchJumpStyle(false);\n                break;\n        }\n    },\n\n    onKeyUp (event) {\n        // unset a flag when key released\n        switch(event.keyCode) {\n            case cc.macro.KEY.a:\n                this.accLeft = false;\n                break;\n            case cc.macro.KEY.d:\n                this.accRight = false;\n                break;\n        }\n    },\n\n    onTouchStart (event) {\n        var touchLoc = event.getLocation();\n        if (touchLoc.x > cc.winSize.width/2) {\n            if(touchLoc.y > cc.winSize.height/2){\n                this.switchJumpStyle(true);\n            }else{\n                this.accLeft = false;\n                this.accRight = true;\n            }\n        } else {\n            if(touchLoc.y > cc.winSize.height/2){\n                this.switchJumpStyle(false);\n            }else{\n                this.accLeft = true;\n                this.accRight = false;\n            }\n        }\n    },\n\n    switchJumpStyle:function(bool){\n        if(bool){\n            if(this.jumpStyleIndex === this.jumpStylesLength-1){\n                this.jumpStyleIndex = 0;\n            }else{\n                this.jumpStyleIndex++;\n            }\n        }else{\n            if(this.jumpStyleIndex===0){\n                this.jumpStyleIndex = this.jumpStylesLength-1;\n            }else{\n                this.jumpStyleIndex--;\n            }\n        }\n        this.changeJumpStyle();\n    },\n\n    changeJumpStyle: function(){\n        let jumpStyles = this.getJumpStyles('key');\n        this.jumpStyleDisplay.string = '跳法：' + jumpStyles[this.jumpStyleIndex];\n\n        // 播放切换武器的声音\n        cc.audioEngine.playEffect(this.switchJumpStyleAudio, false);\n    },\n    \n    onTouchEnd (event) {\n        this.accLeft = false;\n        this.accRight = false;\n    },\n\n    onDestroy () {\n        // 取消键盘输入监听\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n       \n        var touchReceiver = cc.Canvas.instance.node;\n        touchReceiver.off('touchstart', this.onTouchStart, this);\n        touchReceiver.off('touchend', this.onTouchEnd, this);\n    },    \n\n    update: function (dt) {\n        // 根据当前加速度方向每帧更新速度\n        if (this.accLeft) {\n            this.xSpeed -= this.accel * dt;\n        } else if (this.accRight) {\n            this.xSpeed += this.accel * dt;\n        }\n        // 限制主角的速度不能超过最大值\n        if ( Math.abs(this.xSpeed) > this.maxMoveSpeed ) {\n            // if speed reach limit, use max speed with current direction\n            this.xSpeed = this.maxMoveSpeed * this.xSpeed / Math.abs(this.xSpeed);\n        }\n\n        // 根据当前速度更新主角的位置\n        this.node.x += this.xSpeed * dt;\n\n        let gameLevel = this.node.parent.getComponent('Game').gameLevel;\n\n        // limit player_ position inside screen\n        if ( this.node.x > (this.node.parent.width/2 + gameLevel*0.7)) {\n            this.node.x = this.node.parent.width/2 + gameLevel*0.7;\n            this.xSpeed = 0;\n        } else if (this.node.x < (-this.node.parent.width/2 - gameLevel*0.7)) {\n            this.node.x = -this.node.parent.width/2 - gameLevel*0.7;\n            this.xSpeed = 0;\n        }\n    },\n\n});\n\n\n"]}