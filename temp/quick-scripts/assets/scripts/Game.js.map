{"version":3,"sources":["Game.js"],"names":["UserDataManager","require","cc","Class","extends","Component","properties","bgm","default","type","AudioClip","title","Node","bgs","gameTimer","Label","gameCamera","Camera","starNumber","currentStarNumber","currentStars","mostHit","starPrefab","Prefab","redStarPrefab","scoreFXPrefab","rankList","ground","player","twiceJumpGetScore","scoreKeeper","scoreDisplay","farCameraAudio","scoreAudio","menuNode","gameOverNode","youWinNode","controlHintLabel","keyboardHint","multiline","touchHint","winScoreLabel","gameWinAudio","gameOverAudio","onLoad","loadData","audioEngine","playEffect","redStar","timeKeeper","menuToFirstPanel","iniBg","groundY","y","height","currentStarX","enabled","string","sys","isMobile","starPool","NodePool","scorePool","initGame","iniStarDuration","starDuration","gameLevel","cameraFarSpeed","starMoreSpeed","time","score","zoomRatio","startGame","active","startGameTimer","resetScore","getComponent","startMoveAt","spawnNewStar","spawnRedStar","menuHideAll","c","children","i","menuToShop","menuToGuide","menuToRank","axios","get","then","console","log","response","data","catch","error","menuToAbout","zIndex","scale","bgChildren","l","length","Math","floor","random","setInterval","toFixed","bind","stopGameTimer","clearInterval","instantiate","node","addChild","destY","startY","jumpHeight","startX","width","setPosition","v2","init","yDistance","runAction","moveBy","newStar","size","getNewStarPosition","startTimer","push","despawnStar","star","put","timer","randY","maxX","randX","gainScore","pos","fx","spawnScoreFX","theScoreShow","_components","_string","play","despawnScoreFX","scoreFX","gameUpgrade","farBg","times","modify","update","dt","gameOver","gameWin","finalScore","pow","again","sendScore","stopMove","clear","destroy"],"mappings":"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","file":"Game.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["let UserDataManager = require(\"UserDataManager\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n        bgm: {\n            default: null,\n            type: cc.AudioClip\n        },\n\n        title: {\n            default: null,\n            type: cc.Node\n        },\n\n        bgs: {\n            default: null,\n            type: cc.Node\n        },\n        gameTimer: {\n            default: null,\n            type: cc.Label\n        },\n\n        gameCamera: {\n            default: null,\n            type: cc.Camera\n        },\n        starNumber: 1,\n        currentStarNumber: 1,\n        currentStars: [],\n        mostHit: 0,\n\n        // 这个属性引用了星星预制资源\n        starPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        redStarPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        scoreFXPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n\n        rankList: {\n            default: null,\n            type: cc.Label\n        },\n        ground: {\n            default: null,\n            type: cc.Node\n        },\n        player: {\n            default: null,\n            type: cc.Node\n        },\n        twiceJumpGetScore: 0,\n        scoreKeeper: 1,\n        scoreDisplay: {\n            default: null,\n            type: cc.Label\n        },\n\n        farCameraAudio: {\n            default: null,\n            type: cc.AudioClip\n        },\n        scoreAudio: {\n            default: null,\n            type: cc.AudioClip\n        },\n\n        menuNode: {\n            default: null,\n            type: cc.Node\n        },\n        gameOverNode: {\n            default: null,\n            type: cc.Node\n        },\n        youWinNode: {\n            default: null,\n            type: cc.Node\n        },\n        controlHintLabel: {\n            default: null,\n            type: cc.Label\n        },\n        keyboardHint: {\n            default: '',\n            multiline: true\n        },\n        touchHint: {\n            default: '',\n            multiline: true\n        },\n        winScoreLabel: {\n            default: null,\n            type: cc.Label\n        },\n        gameWinAudio: {\n            default: null,\n            type: cc.AudioClip\n        },\n        gameOverAudio: {\n            default: null,\n            type: cc.AudioClip\n        },\n    },\n\n    onLoad() {\n\n        UserDataManager.loadData();\n\n        cc.audioEngine.playEffect(this.bgm, true);\n\n        this.redStar = null;\n        this.timeKeeper = null;\n\n        this.menuToFirstPanel();\n        this.iniBg();\n\n        this.groundY = this.ground.y + this.ground.height / 2 - 10;\n\n        this.currentStarX = 0;\n\n        this.enabled = false;\n\n        this.controlHintLabel.string = \"操作说明：\\n\" + (cc.sys.isMobile ? this.touchHint : this.keyboardHint);\n        this.starPool = new cc.NodePool('Star');\n        this.scorePool = new cc.NodePool('ScoreFX');\n    },\n\n    initGame() {\n        this.iniStarDuration = 6;\n        this.starDuration = 0;\n        this.gameLevel = 0;\n        this.cameraFarSpeed = 10;  // 拉远镜头频率\n        this.starMoreSpeed = 30;   // 星星增加频率\n        this.time = 0;\n        this.score = 0;\n        this.scoreKeeper = 1,\n            this.currentStarNumber = 1;\n        this.mostHit = 0;\n        this.starNumber = 1;\n        this.gameCamera.zoomRatio = 1;\n    },\n\n    startGame() {\n\n        this.title.active = false;\n        this.initGame();\n        this.iniBg();\n        this.startGameTimer();\n        this.resetScore();\n        this.enabled = true;\n        this.menuNode.active = false;\n        this.gameOverNode.active = false;\n        this.youWinNode.active = false;\n        this.player.getComponent('Player').startMoveAt(0, this.groundY);\n\n        this.spawnNewStar();\n        this.spawnRedStar();\n    },\n\n    // 关于菜单部分\n    menuHideAll() {\n        let c = this.menuNode.children;\n        for (let i of c) i.active = false;\n        return c;\n    },\n    menuToFirstPanel() {\n        let c = this.menuHideAll();\n        c[0].active = true;\n    },\n    // menuToAttribute() {\n    //     let c = this.menuHideAll();\n    //     c[1].active = true;\n    // },\n    menuToShop() {\n        let c = this.menuHideAll();\n        c[2].active = true;\n    },\n    menuToGuide() {\n        let c = this.menuHideAll();\n        c[3].active = true;\n    },\n    menuToRank() {\n        let c = this.menuHideAll();\n        c[4].active = true;\n        axios.get('/ranklist')\n            .then(response => {\n                console.log(response);\n                this.rankList.string = response.data;\n            })\n            .catch(error => {\n                console.log(error)\n            })\n    },\n    menuToAbout() {\n        let c = this.menuHideAll();\n        c[5].active = true;\n    },\n\n\n    iniBg() {\n        this.bgs.zIndex = -10;\n        this.bgs.scale = 1;\n        console.log(this.bgs);\n        console.log(this.bgs.scale)\n\n        let bgChildren = this.bgs.children;\n        let l = bgChildren.length;\n        for (let i of bgChildren) {\n            i.active = false;\n        }\n        bgChildren[Math.floor(Math.random() * l)].active = true;\n    },\n\n    startGameTimer() {\n        this.timeKeeper = setInterval(function () {\n            this.time += 0.01;\n            this.gameTimer.string = \"Time: \" + this.time.toFixed(2);\n        }.bind(this), 10);\n    },\n    stopGameTimer() {\n        clearInterval(this.timeKeeper);\n    },\n\n\n    spawnRedStar() {\n        this.redStar = cc.instantiate(this.redStarPrefab);\n        this.node.addChild(this.redStar);\n\n        let destY = this.node.height / 2 - this.redStar.height / 2;\n        let startY = this.groundY + this.player.getComponent('Player').jumpHeight + 150;\n        let startX = (Math.random() - 0.5) * 2 * (this.node.width / 2 - this.redStar.height / 2);\n        this.redStar.setPosition(cc.v2(startX, startY));\n        this.redStar.getComponent('RedStar').init(this);\n\n        let yDistance = destY - startY;\n        this.redStar.runAction(cc.moveBy(yDistance * 0.6, 0, destY));\n\n        // let t = this;\n        // (function rising() {\n        //     setTimeout(function () {\n        //         t.redStar.setPosition(cc.v2(startX, startY));\n        //         startY++;\n        //         if (startY < destY) rising();\n        //     }, 600);\n        // })();\n    },\n\n    spawnNewStar() {\n        var newStar = null;\n        if (this.starPool.size() > 0) {\n            newStar = this.starPool.get(this);\n            console.log(\"Game-spawnNewStart form startPool\");\n        } else {\n            newStar = cc.instantiate(this.starPrefab);\n        }\n\n        this.node.addChild(newStar);\n        newStar.setPosition(this.getNewStarPosition());\n        newStar.getComponent('Star').init(this);\n\n        this.startTimer();\n        this.currentStars.push(newStar);\n    },\n\n    despawnStar(star) {\n        this.starPool.put(star);\n        this.currentStarNumber--;\n        if (this.currentStarNumber === 0) {\n            for (let i = 0; i < this.starNumber; i++) {\n                this.spawnNewStar();\n            }\n            this.currentStarNumber = this.starNumber;\n        }\n    },\n\n    startTimer() {\n        this.starDuration = this.iniStarDuration - this.gameLevel / 150;\n        this.timer = 0;\n    },\n\n    getNewStarPosition() {\n        var randY = this.groundY + Math.random() * this.player.getComponent('Player').jumpHeight + 30;\n        var maxX = this.node.width / 2;\n        var randX = (Math.random() - 0.5) * 2 * maxX;\n        return cc.v2(randX, randY);\n    },\n\n\n    gainScore(pos) {\n        this.score += this.scoreKeeper;\n        if (this.scoreKeeper > this.mostHit) {\n            this.mostHit = this.scoreKeeper;\n        }\n        this.scoreDisplay.string = 'Score: ' + this.score;\n        this.twiceJumpGetScore = 2;\n\n        var fx = this.spawnScoreFX();\n        var theScoreShow = fx.node.children[0].children[1]._components[0];\n        theScoreShow._string = \"+\" + this.scoreKeeper;\n        this.node.addChild(fx.node);\n        fx.node.setPosition(pos);\n        fx.play();\n\n        cc.audioEngine.playEffect(this.scoreAudio, false);\n        this.scoreKeeper++;\n    },\n    resetScore() {\n        this.score = 0;\n        this.scoreDisplay.string = 'Score: ' + this.score;\n    },\n\n    spawnScoreFX() {\n        var fx;\n        fx = cc.instantiate(this.scoreFXPrefab).getComponent('ScoreFX');\n        fx.init(this);\n        return fx;\n    },\n\n    despawnScoreFX(scoreFX) {\n        this.scorePool.put(scoreFX);\n    },\n\n    gameUpgrade() {\n        this.gameLevel++;\n        if (this.gameLevel % this.cameraFarSpeed === 0) {\n            this.farBg();\n        }\n        if (this.gameLevel < 21 && this.gameLevel % 10 === 0) {\n            this.starNumber++;\n        }\n        if (this.gameLevel % this.starMoreSpeed === 0) {\n            this.starNumber++;\n            this.iniStarDuration += 0.7;\n        }\n    },\n\n    farBg() {\n        let times = 0;\n        let modify = setInterval(function () {\n            this.bgs.scale *= (999 / 1000);\n            times++;\n            if (times == 10) {\n                clearInterval(modify);\n            }\n        }.bind(this), 50)\n        cc.audioEngine.playEffect(this.farCameraAudio, false);\n    },\n\n    update(dt) {\n        if (this.timer > this.starDuration) {\n            this.gameOver();\n            this.enabled = false;\n            return;\n        }\n        this.timer += dt;\n    },\n\n    gameWin() {\n        this.finalScore = (Math.pow((300 / this.time.toFixed(2)), 2).toFixed(2) * this.score).toFixed(0);\n        this.winScoreLabel.string = 'Final Score: ' + this.finalScore + '\\n' + \"Most Hit: \" + this.mostHit;\n\n        this.youWinNode.active = true;\n        this.again();\n        cc.audioEngine.playEffect(this.gameWinAudio, false);\n    },\n\n    gameOver() {\n        this.gameOverNode.active = true;\n        this.again();\n        cc.audioEngine.playEffect(this.gameOverAudio, false);\n    },\n\n    again() {\n        this.sendScore();\n        this.player.getComponent('Player').stopMove();\n        this.stopGameTimer();\n        this.menuNode.active = true;\n        this.enabled = false;\n        this.starPool.clear();\n        this.redStar.destroy();\n        for (let i of this.currentStars) {\n            i.destroy();\n        }\n        this.currentStars = [];\n    },\n    sendScore() {\n        console.log(\"Game-sendScore\");\n    }\n\n});"]}