{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\Player.js"],"names":["cc","Class","extends","Component","properties","controller","default","type","Node","mobileController","money","Label","sur","playerJumpDurationValue","playerAccelValue","player_sur","player_jumpDuration","player_accel","canAttrAudio","AudioClip","cannotAttrAudio","jumpAudio","jumpActionArray","switchJumpStyleAudio","jumpInterval","jumpStyleIndex","jumpStyles","jumpStylesLength","jumpStyleDisplay","onLoad","window","localStorage","getItem","enabled","minPosX","node","parent","width","maxPosX","getJumpStyles","length","initInput","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","console","log","document","body","clientWidth","active","touchReceiver","onTouchStart","onTouchEnd","initAttr","height","jumpHeight","jumpDuration","accel","squashDuration","maxMoveSpeed","rise_jumpHeight","rise_jumpDuration","rise_accel","upgrade","canAddAttr","canSubAttr","playAttrAudio","bool","audioEngine","playEffect","updatePlayerAttr","string","addPlayerJumpDuration","subPlayerJumpDuration","children","addPlayerAccel","subPlayerAccel","r","styleKeys","styleValues","jumping","jumpUp","moveBy","v2","easing","jumpDown","squash","scaleTo","stretch","scaleBack","callback","callFunc","playJumpSound","runAction","repeat","sequence","game","getComponent","twiceJumpGetScore","scoreKeeper","Math","ceil","readyJump","t","setTimeout","getCenterPos","centerPos","x","y","startMoveAt","canStop","xSpeed","accLeft","accRight","setPosition","stopMove","stopAllActions","clearInterval","turnLeft","turnRight","event","keyCode","macro","KEY","a","d","w","switchJumpStyle","s","stopXSpeed","q","speedDown","touchLoc","getLocation","winSize","bind","reverseXSpeed","changeJumpStyle","onDestroy","off","update","dt","abs","gameLevel"],"mappings":"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","file":"Player.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\n    extends: cc.Component,\n    \n    properties: {\n\n        controller:{\n            default:null,\n            type:cc.Node\n        },\n        mobileController:{\n        \tdefault:null,\n            type:cc.Node\n        },\n        money:{\n            default:null,\n            type:cc.Label\n        },\n        sur:{\n            default:null,\n            type:cc.Label\n        },\n        playerJumpDurationValue:{\n            default:null,\n            type:cc.Label\n        },\n        playerAccelValue:{\n            default:null,\n            type:cc.Label\n        },\n        player_sur:0,\n        player_jumpDuration:10,\n        player_accel:10,\n\n        // attrSucc:false,  //是否成功修改属性\n        canAttrAudio:{\n            default:null,\n            type:cc.AudioClip\n        },\n        cannotAttrAudio:{\n            default:null,\n            type:cc.AudioClip\n        },\n        // 跳跃音效资源\n        jumpAudio: {\n            default: null,\n            type: cc.AudioClip\n        },\n        jumpActionArray:[],\n        switchJumpStyleAudio: {\n            default: null,\n            type: cc.AudioClip\n        },\n        jumpInterval:null,\n        jumpStyleIndex:0,\n\n        jumpStyles:null,\n        jumpStylesLength:0,\n        // jumpStyle label 的引用\n        jumpStyleDisplay: {\n            default: null,\n            type: cc.Label\n        },\n    },\n\n    onLoad: function() {\n\n        let money = window.localStorage.getItem('money');\n\n\n\n        this.enabled = false;\n        // screen boundaries\n        this.minPosX = -this.node.parent.width/2;\n        this.maxPosX = this.node.parent.width/2;\n\n        this.jumpStyles = this.getJumpStyles();\n        this.jumpStylesLength = this.jumpStyles.length;\n\n        this.initInput();\n    },\n\n    initInput:function(){\n        // 初始化键盘输入监听\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n\n        console.log('initInput')\n        if(document.body.clientWidth < 960){\n        \tthis.mobileController.active = true;\n        }else{\n        \tthis.mobileController.active = false;\n        }\n        // console.log(document.body.clientWidth)\n        // console.log(document.body.clientHeight)\n        return ;\n        // 手机触摸屏\n        var touchReceiver = this.controller;\n        touchReceiver.on('touchstart', this.onTouchStart, this);\n        touchReceiver.on('touchend', this.onTouchEnd, this); \n    },\n\n    initAttr:function(){\n        this.height=0; //初始高度\n        this.jumpHeight=120; // 主角跳跃高度\n        this.jumpDuration=0.3;  // 主角跳跃持续时间\n        this.accel=400; // 加速度\n        this.squashDuration = 0.03; // 辅助形变动作时间\n        this.maxMoveSpeed = 3000; // 最大移动速度\n    \n        this.rise_jumpHeight = 0.7;\n        this.rise_jumpDuration = 0.0005;\n        this.rise_accel = 2.5;\n    },        \n    upgrade: function(){\n        this.jumpHeight += (this.rise_jumpHeight);\n        this.jumpDuration += this.rise_jumpDuration * (10 + this.player_jumpDuration) / 30;\n        this.accel += this.rise_accel * (10 + this.player_accel) / 30;\n    },\n    canAddAttr(){\n        if(this.player_sur < 1){\n            return false;\n        }else{\n            this.player_sur--;\n            return true;\n        }\n    },\n    canSubAttr(){\n        if(this.player_sur > 19){\n            return false;   \n        }else{\n            this.player_sur++;\n            return true;\n        }\n    },\n    playAttrAudio(bool){\n        cc.audioEngine.playEffect(this[bool?'canAttrAudio':'cannotAttrAudio'], false);\n        return bool;\n    },\n    updatePlayerAttr(){\n        this.sur.string = '剩余点数：' + this.player_sur;\n        this.playerJumpDurationValue.string = this.player_jumpDuration;\n        this.playerAccelValue.string = this.player_accel;\n    },\n    addPlayerJumpDuration(){\n        if(this.playAttrAudio(this.player_jumpDuration<20&&this.canAddAttr())){\n            this.player_jumpDuration++;   \n            this.updatePlayerAttr();\n        }\n    },\n    subPlayerJumpDuration(){\n        console.log(this.node.children[0])\n        if(this.playAttrAudio(this.player_jumpDuration>0&&this.canSubAttr())){\n            this.player_jumpDuration--;\n            this.updatePlayerAttr();\n        }\n    },\n    addPlayerAccel(){\n        if(this.playAttrAudio(this.player_accel<20&&this.canAddAttr())){\n            this.player_accel++;\n            this.updatePlayerAttr();\n        }\n    },\n    subPlayerAccel(){\n        if(this.playAttrAudio(this.player_accel>0&&this.canSubAttr())){\n            this.player_accel--;   \n            this.updatePlayerAttr();\n        }\n    },\n\n\n    getJumpStyles: function(r){\n\n        let styleKeys = [\n            // '起跳'\n            '正常',\n            '漂浮',\n            // '弹簧',\n            // '震动',\n            '二段',\n            '轻功',\n            '滞空'\n            // '悬空',\n            // '和谐',\n            \n        ];\n        let styleValues = [\n            // ['easeExponentialOut','easeExponentialIn'] //起跳\n            ['easeCubicActionOut','easeCubicActionIn']  //正常\n            ,['easeSineOut','easeSineIn'] //漂浮\n            // ,['easeElasticOut','easeElasticIn'] //弹簧\n            // ,['easeBounceOut','easeBounceIn'] //震动\n            ,['easeBackOut','easeBackIn'] //二段\n            ,['easeQuadraticActionOut','easeQuadraticActionIn']  //轻功\n            ,['easeQuarticActionOut','easeQuarticActionIn'] //滞空\n            // ,['easeQuinticActionOut','easeQuinticActionIn'] //悬空\n            // ,['easeCircleActionOut','easeCircleActionIn'] //和谐\n        ];\n\n        return r==='key'?styleKeys:styleValues;\n    },\n\n\tjumping: function(){\n\n        let jumpStyles = this.jumpStyles\n            ,jumpUp = cc.moveBy(this.jumpDuration, cc.v2(0, this.jumpHeight)).easing(cc[jumpStyles[this.jumpStyleIndex][0]]())\n            ,jumpDown = cc.moveBy(this.jumpDuration, cc.v2(0, -this.jumpHeight)).easing(cc[jumpStyles[this.jumpStyleIndex][1]]())\n            ,squash = cc.scaleTo(this.squashDuration, 1, 0.6)\n            ,stretch = cc.scaleTo(this.squashDuration, 1, 1.2)\n            ,scaleBack = cc.scaleTo(this.squashDuration, 1, 1)\n            ,callback = cc.callFunc(this.playJumpSound, this);\n\n        this.node.runAction(cc.repeat(cc.sequence(squash, stretch, jumpUp, scaleBack, jumpDown, callback),1));\n        \n        if(this.enabled){\n\t\t\tlet game = this.node.parent.getComponent('Game');\n\t\t\tif(game.twiceJumpGetScore === 0){\n\t\t\t\tgame.scoreKeeper = Math.ceil(game.scoreKeeper * 4/5);\n\t\t\t}else{\n                game.twiceJumpGetScore --;\n            }\n        \tthis.readyJump();\n        }\n    },\n\n    readyJump: function () {\n\t\tlet t = this;\n\t\tsetTimeout(function(){\n\t\t\tif(t.enabled) t.jumping();\n\t\t},t.jumpDuration*2000+t.squashDuration*3000);\n    },\n\n    playJumpSound: function () {\n        // 调用声音引擎播放声音\n        cc.audioEngine.playEffect(this.jumpAudio, false);\n    },\n\n    getCenterPos: function () {\n        var centerPos = cc.v2(this.node.x, this.node.y + this.node.height/2);\n        return centerPos;\n    },\n\n    startMoveAt: function (x,y) {\n        this.canStop = true;\n        this.enabled = true;\n        this.enabled = true;\n        this.xSpeed = 0; // 主角当前水平方向速度\n        this.accLeft = false;  // 加速度方向开关\n        this.accRight = false;\n        this.initAttr();\n        this.readyJump();\n        this.node.setPosition(x,y);\n    },\n\n    stopMove: function () {\n        this.enabled = false;\n        this.node.stopAllActions();\n        clearInterval(this.jumpInterval);\n    },\n\n    turnLeft(){\n        this.accLeft = true;\n        this.accRight = false;\n    },\n    turnRight(){\n    \tthis.accRight = true;\n        this.accLeft = false;\n    },\n\n    onKeyDown (event) {\n        // set a flag when key pressed\n        switch(event.keyCode) {\n            case cc.macro.KEY.a:\n                this.turnLeft();\n                break;\n            case cc.macro.KEY.d:\n                this.turnRight();\n                break;\n            case cc.macro.KEY.w:\n                this.switchJumpStyle();\n                break;\n            case cc.macro.KEY.s:\n                this.stopXSpeed();\n                break;\n            case cc.macro.KEY.q:\n                this.speedDown();\n                break;\n        }\n    },\n\n    onKeyUp (event) {\n        // unset a flag when key released\n        switch(event.keyCode) {\n            case cc.macro.KEY.a:\n                this.accLeft = false;\n                break;\n            case cc.macro.KEY.d:\n                this.accRight = false;\n                break;\n        }\n    },\n\n    onTouchStart (event) {\n        var touchLoc = event.getLocation();\n        if(touchLoc.y > cc.winSize.height * 0.6){\n            this.switchJumpStyle();\n        }else{\n            if (touchLoc.x < cc.winSize.width/3) {\n                this.accLeft = true;\n                this.accRight = false;\n            } else if(touchLoc.x > cc.winSize.width * 2/3){\n                this.accLeft = false;\n                this.accRight = true;\n            }else{\n                this.stopXSpeed();\n            }\n        }\n    },\n\n    stopXSpeed(){\n        if(this.canStop){\n            this.xSpeed /= -1.2;\n        }\n    },\n    speedDown(){\n        this.xSpeed /= 2;\n        setTimeout(function(){\n        \tthis.xSpeed /= 0.3;\n        }.bind(this),1000);\n    },\n    reverseXSpeed(){\n        this.xSpeed /= -1.2;\n        this.canStop = false;\n        setTimeout(function() {\n            this.canStop = true;\n        }.bind(this), 100);   \n\n    },\n\n    switchJumpStyle:function(){\n        if(this.jumpStyleIndex === this.jumpStylesLength-1){\n            this.jumpStyleIndex = 0;\n        }else{\n            this.jumpStyleIndex++;\n        }\n        this.changeJumpStyle();\n    },\n\n    changeJumpStyle: function(){\n        let jumpStyles = this.getJumpStyles('key');\n        this.jumpStyleDisplay.string = '跳法：' + jumpStyles[this.jumpStyleIndex];\n\n        // 播放切换武器的声音\n        cc.audioEngine.playEffect(this.switchJumpStyleAudio, false);\n    },\n    \n    onTouchEnd (event) {\n        this.accLeft = false;\n        this.accRight = false;\n    },\n\n    onDestroy () {\n        // 取消键盘输入监听\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n       \n       \treturn ;\n        var touchReceiver = this.controller;\n        touchReceiver.off('touchstart', this.onTouchStart, this);\n        touchReceiver.off('touchend', this.onTouchEnd, this);\n    },    \n\n    update: function (dt) {\n        // 根据当前加速度方向每帧更新速度\n        if (this.accLeft) {\n            this.xSpeed -= this.accel * dt;\n        } else if (this.accRight) {\n            this.xSpeed += this.accel * dt;\n        }\n        // 限制主角的速度不能超过最大值\n        if ( Math.abs(this.xSpeed) > this.maxMoveSpeed ) {\n            // if speed reach limit, use max speed with current direction\n            this.xSpeed = this.maxMoveSpeed * this.xSpeed / Math.abs(this.xSpeed);\n        }\n\n        // 根据当前速度更新主角的位置\n        this.node.x += this.xSpeed * dt;\n\n        let gameLevel = this.node.parent.getComponent('Game').gameLevel;\n\n        // limit player_ position inside screen\n        // if ( this.node.x > (this.node.parent.width/2 + gameLevel*0.6)) {\n        //     this.node.x = this.node.parent.width/2 + gameLevel*0.6;\n        //     this.reverseXSpeed();\n        // } else if (this.node.x < (-this.node.parent.width/2 - gameLevel*0.6)) {\n        //     this.node.x = -this.node.parent.width/2 - gameLevel*0.6;\n        //     this.reverseXSpeed();\n        // }\n\n        if ( this.node.x > this.node.parent.width/2) {\n            this.node.x = this.node.parent.width/2;\n            this.reverseXSpeed();\n        } else if (this.node.x < -this.node.parent.width/2) {\n            this.node.x = -this.node.parent.width/2;\n            this.reverseXSpeed();\n        }\n    },\n});\n\n\n"]}