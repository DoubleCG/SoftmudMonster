{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\Main.js"],"names":["UserDataManager","require","AudioManager","WX","Main","cc","Class","extends","Component","properties","bg","Node","title","gameTimer","Label","starPrefab","Prefab","redStarPrefab","scoreFXPrefab","ground","player","scoreLabel","menuNode","gameOverNode","youWinNode","statics","instance","ctor","onLoad","starNumber","currentStarNumber","currentStars","mostHit","twiceJumpGetScore","scoreKeeper","login","loadData","play","redStar","timeKeeper","menuToFirstPanel","iniBg","groundY","y","height","currentStarX","enabled","starPool","NodePool","scorePool","startGame","active","initGame","startGameTimer","resetScore","getComponent","startMoveAt","spawnStar","spawnRedStar","starsDuration","levelCount","cameraFarSpeed","time","score","menuHideAll","c","children","i","menuToShop","menuToGuide","menuToRank","menuToAbout","bgNumber","bgIndex","Math","floor","random","loader","loadRes","SpriteFrame","err","spriteFrame","console","error","addComponent","Sprite","scale","setInterval","string","toFixed","stopGameTimer","clearInterval","instantiate","node","addChild","destY","startY","jumpHeight","startX","width","setPosition","v2","init","yDistance","runAction","moveBy","roadWidth","totalTime","speed","sequence","moveTo","callFunc","repeatForever","star","size","get","log","randY","randX","timer","push","despawnStar","put","gainScore","pos","fx","spawnScoreFX","theScoreShow","_components","_string","despawnScoreFX","scoreFX","gameUpgrade","farBg","scaleBy","update","dt","gameOver","gameWin","again","sendScore","stopMove","clear","destroy"],"mappings":"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","file":"Main.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["let UserDataManager = require(\"UserDataManager\");\nlet AudioManager = require(\"AudioManager\");\nlet WX = require(\"WX\");\n\nlet Main = cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        bg: cc.Node,\n        title: cc.Node,\n        gameTimer: cc.Label,\n        starPrefab: cc.Prefab,\n        redStarPrefab: cc.Prefab,\n        scoreFXPrefab: cc.Prefab,\n        ground: cc.Node,\n        player: cc.Node,\n        scoreLabel: cc.Label,\n        menuNode: cc.Node,\n        gameOverNode: cc.Node,\n        youWinNode: cc.Node,\n    },\n\n    statics: {\n        instance: null\n    },\n\n    ctor() {\n        if (!Main.instance) {\n            Main.instance = this;\n        }\n    },\n\n    onLoad() {\n        this.starNumber = 1;\n        this.currentStarNumber = 1;\n        this.currentStars = [];\n        this.mostHit = 0;\n        this.twiceJumpGetScore = 0;\n        this.scoreKeeper = 1;\n\n        WX.login();\n        UserDataManager.loadData();\n\n        AudioManager.instance.play(\"bgm\", true);\n\n        this.redStar = null;\n        this.timeKeeper = null;\n\n        this.menuToFirstPanel();\n        this.iniBg();\n\n        this.groundY = this.ground.y + this.ground.height / 2 - 10;\n\n        this.currentStarX = 0;\n        this.enabled = false;\n\n        this.starPool = new cc.NodePool('Star');\n        this.scorePool = new cc.NodePool('ScoreFX');\n    },\n\n    startGame() {\n        this.title.active = false;\n        this.initGame();\n        this.iniBg();\n        this.startGameTimer();\n        this.resetScore();\n        this.enabled = true;\n        this.menuNode.active = false;\n        this.gameOverNode.active = false;\n        this.youWinNode.active = false;\n        this.player.getComponent('Player').startMoveAt(0, this.groundY);\n\n        this.spawnStar();\n        this.spawnRedStar();\n    },\n    initGame() {\n        this.starsDuration = 4;\n        this.levelCount = 0;\n        this.cameraFarSpeed = 10;  // 拉远镜头频率\n        this.time = 0;\n        this.score = 0;\n        this.scoreKeeper = 1;\n        this.currentStarNumber = 1;\n        this.mostHit = 0;\n        this.starNumber = 1;\n    },\n    // 关于菜单部分\n    menuHideAll() {\n        let c = this.menuNode.children;\n        for (let i of c) i.active = false;\n        return c;\n    },\n    menuToFirstPanel() {\n        let c = this.menuHideAll();\n        c[0].active = true;\n    },\n    // menuToAttribute() {\n    //     let c = this.menuHideAll();\n    //     c[1].active = true;\n    // },\n    menuToShop() {\n        let c = this.menuHideAll();\n        c[2].active = true;\n    },\n    menuToGuide() {\n        let c = this.menuHideAll();\n        c[3].active = true;\n    },\n    menuToRank() {\n        let c = this.menuHideAll();\n        c[4].active = true;\n    },\n    menuToAbout() {\n        let c = this.menuHideAll();\n        c[5].active = true;\n    },\n\n\n    iniBg() {\n        let bgNumber = 1;\n        let bgIndex = Math.floor(Math.random() * bgNumber);\n        cc.loader.loadRes(\"bgs/\" + bgIndex, cc.SpriteFrame, (err, spriteFrame) => {\n            if (err) console.error(err);\n            this.bg.addComponent(cc.Sprite).spriteFrame = spriteFrame;\n            this.bg.scale = 1.2;\n        });\n    },\n\n    startGameTimer() {\n        this.timeKeeper = setInterval(() => {\n            this.time += 0.01;\n            this.gameTimer.string = \"Time: \" + this.time.toFixed(2);\n        }, 10);\n    },\n    stopGameTimer() {\n        clearInterval(this.timeKeeper);\n    },\n\n    spawnRedStar() {\n        this.redStar = cc.instantiate(this.redStarPrefab);\n        this.node.addChild(this.redStar);\n\n        let destY = this.node.height / 2 - this.redStar.height / 2;\n        let startY = this.groundY + this.player.getComponent('Player').jumpHeight + 150;\n        let startX = (Math.random() - 0.5) * 0.9 * this.node.width;\n        this.redStar.setPosition(cc.v2(startX, startY));\n        this.redStar.getComponent('RedStar').init(this);\n\n        let yDistance = destY - startY;\n        this.redStar.runAction(cc.moveBy(yDistance * 0.6, 0, destY));\n\n        let roadWidth = this.node.width * 0.9;\n        let totalTime = 20;\n        let speed = roadWidth / totalTime;\n        let time = (roadWidth / 2 - startX) / speed;\n        this.redStar.runAction(cc.sequence(\n            cc.moveTo(time, roadWidth * 0.45, 0),\n            cc.callFunc(() => {\n                this.redStar.runAction(\n                    cc.repeatForever(cc.sequence(\n                        cc.moveTo(totalTime, -roadWidth * 0.45, 0),\n                        cc.moveTo(totalTime, roadWidth * 0.45, 0)\n                    ))\n                )\n            })\n        ));\n    },\n\n    spawnStar() {\n        var star = null;\n        if (this.starPool.size() > 0) {\n            star = this.starPool.get(this);\n            console.log(\"Game-spawnStar form startPool\");\n        } else {\n            star = cc.instantiate(this.starPrefab);\n        }\n\n        this.node.addChild(star);\n        var randY = this.groundY + Math.random() * this.player.getComponent('Player').jumpHeight + 30;\n        var randX = (Math.random() - 0.5) * 0.9 * this.node.width;\n        let v2 = cc.v2(randX, randY);\n        star.setPosition(v2);\n        star.getComponent('Star').init(this);\n\n        this.timer = 0;\n        this.currentStars.push(star);\n    },\n\n    despawnStar(star) {\n        this.starPool.put(star);\n        this.currentStarNumber--;\n        if (this.currentStarNumber === 0) {\n            for (let i = 0; i < this.starNumber; i++) {\n                this.spawnStar();\n            }\n            this.currentStarNumber = this.starNumber;\n        }\n    },\n\n    gainScore(pos) {\n        this.score += this.scoreKeeper;\n        if (this.scoreKeeper > this.mostHit) {\n            this.mostHit = this.scoreKeeper;\n        }\n        this.scoreLabel.string = 'Score: ' + this.score;\n        this.twiceJumpGetScore = 2;\n\n        var fx = this.spawnScoreFX();\n        var theScoreShow = fx.node.children[0].children[1]._components[0];\n        theScoreShow._string = \"+\" + this.scoreKeeper;\n        this.node.addChild(fx.node);\n        fx.node.setPosition(pos);\n        fx.play();\n\n        AudioManager.instance.play(\"addScore\", false);\n        this.scoreKeeper++;\n    },\n    resetScore() {\n        this.score = 0;\n        this.scoreLabel.string = 'Score: ' + this.score;\n    },\n\n    spawnScoreFX() {\n        var fx;\n        fx = cc.instantiate(this.scoreFXPrefab).getComponent('ScoreFX');\n        fx.init(this);\n        return fx;\n    },\n\n    despawnScoreFX(scoreFX) {\n        this.scorePool.put(scoreFX);\n    },\n\n    gameUpgrade() {\n        this.levelCount++;\n        if (this.levelCount % (5 * this.starNumber) === 0) {\n            this.farBg();\n            this.levelCount = 0;\n            this.starNumber++;\n            this.starsDuration += 0.2;\n        }\n    },\n\n    farBg() {\n        this.bg.runAction(cc.scaleBy(0.5, 0.95));\n        AudioManager.instance.play(\"farCamera\", false);\n    },\n\n    update(dt) {\n        if (this.timer > this.starsDuration) {\n            this.gameOver();\n            this.enabled = false;\n            return;\n        }\n        this.timer += dt;\n    },\n\n    gameWin() {\n        this.youWinNode.active = true;\n        this.again();\n        AudioManager.instance.play(\"gameWin\", false);\n    },\n\n    gameOver() {\n        this.gameOverNode.active = true;\n        this.again();\n        AudioManager.instance.play(\"gameOver\", false);\n    },\n\n    again() {\n        this.sendScore();\n        this.player.getComponent('Player').stopMove();\n        this.stopGameTimer();\n        this.menuNode.active = true;\n        this.enabled = false;\n        this.starPool.clear();\n        this.redStar.destroy();\n        for (let i of this.currentStars) {\n            i.destroy();\n        }\n        this.currentStars = [];\n    },\n    sendScore() {\n        console.log(\"Game-sendScore\");\n    }\n\n});"]}