{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\WX.js"],"names":["Config","require","data","bestScore","loginDays","personCode","playTime","shareTimes","totalScore","local","isLocal","personNumber","setBestScore","score","addLoginDays","modifyPersonCode","isAdd","addPlayTime","time","addShareTimes","increaseTotalScore","getBestScore","getLoginDays","getPersonCode","getPlayTime","getShareTimes","getTotalScore","WX","hadInid","rewardedVideoAd","isVideoAvalible","login","callback","console","log","_this","wx","cloud","init","env","wxCloudDB","DB","database","COMMAND","command","COLLECTION","collection","openDataContext","getOpenDataContext","createCanvas","callFunction","name","complete","e","openid","result","openId","getUserData","showShareMenu","withShareTicket","updateShareMenu","onShareAppMessage","title","getShareTitle","imageUrl","getShareImgUrl","createRewardedVideoAd","adUnitId","onLoad","isVideoAvailable","onError","err","where","_openid","get","success","res","length","add","fail","error","DOC","doc","_id","navigateToMiniProgram","appId","path","envVersion","updatePersonCode","update","_","inc","updateThisPlay","playData","thisPlayTime","saveRankData","openData","key","value","String","setUserCloudStorage","KVDataList","share","shareAppMessage","showToast","icon","watchVideoAD","show","onClose","isEnded","offClose","titles","index","Math","floor","random","sendMeRankData","getRankData","__proto__","USER","cc","sys","browserType","BROWSER_TYPE_WECHAT_GAME","module","exports"],"mappings":"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","file":"WX.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["const Config = require(\"config\");\r\n\r\n\r\nlet data = {\r\n    bestScore: 0,\r\n    loginDays: 0,\r\n    personCode: 0,\r\n    playTime: 0,\r\n    shareTimes: 0,\r\n    totalScore: 0\r\n};\r\n\r\nconst local = {\r\n    isLocal: true,\r\n    personNumber:53,\r\n\r\n    setBestScore(score) {\r\n        data.bestScore = score;\r\n    },\r\n    addLoginDays() {\r\n        data.loginDays++;\r\n    },\r\n    modifyPersonCode(isAdd) {\r\n        if (isAdd) {\r\n            if(data.personCode < this.personNumber-1){\r\n                data.personCode ++;\r\n            }else{\r\n                data.personCode = 0;\r\n            }\r\n        } else {\r\n            if(data.personCode > 0){\r\n                data.personCode--;\r\n            }else{\r\n                data.personCode = this.personNumber-1;\r\n            }\r\n        }\r\n    },\r\n    addPlayTime(time) {\r\n        data.playTime += time;\r\n    },\r\n    addShareTimes() {\r\n        data.shareTimes++;\r\n    },\r\n    increaseTotalScore(score) {\r\n        data.totalScore += score;\r\n    },\r\n\r\n    getBestScore() {\r\n        return data.bestScore;\r\n    },\r\n    getLoginDays() {\r\n        return data.loginDays;\r\n    },\r\n    getPersonCode() {\r\n        return data.personCode;\r\n    },\r\n    getPlayTime() {\r\n        return data.playTime;\r\n    },\r\n    getShareTimes() {\r\n        return data.shareTimes;\r\n    },\r\n    getTotalScore() {\r\n        return data.totalScore;\r\n    }\r\n}\r\n\r\n\r\nconst WX = {    // 微信平台\r\n    isLocal: false,\r\n    hadInid: false,\r\n    rewardedVideoAd: null,\r\n    isVideoAvalible: false,\r\n\r\n    // 第一时间去用户标识\r\n    login(callback) {\r\n        console.log(\"WX - login\");\r\n        let _this = this;\r\n\r\n        // 微信是 openId\r\n        wx.cloud.init({\r\n            env: Config.env.wxCloudDB\r\n        });\r\n        _this.DB = wx.cloud.database({\r\n            env: Config.env.wxCloudDB,\r\n        });\r\n        _this.COMMAND = _this.DB.command;\r\n        _this.COLLECTION = _this.DB.collection('test');\r\n\r\n\r\n        /*  开放数据域不能向主域发送消息。\r\n            主域可以向开放数据域发送消息。调用 wx.getOpenDataContext() 方法可以获取开放数据域实例，\r\n            调用实例上的 OpenDataContext.postMessage() 方法可以向开放数据域发送消息。 */\r\n        _this.openDataContext = wx.getOpenDataContext();\r\n        _this.createCanvas = wx.createCanvas;\r\n\r\n        // _this.setUserCloudStorage = wx.setUserCloudStorage;\r\n\r\n        wx.cloud.callFunction({\r\n            name: 'login',\r\n            data: {},\r\n            complete(e) {\r\n                _this.openid = e.result.openId;\r\n                _this.getUserData(callback);\r\n            }\r\n        })\r\n\r\n        if (!this.hadInid) {  // 分享初始化  \r\n            this.hadInid = true;\r\n            wx.showShareMenu({ withShareTicket: true });\r\n            wx.updateShareMenu({ withShareTicket: true });\r\n            wx.onShareAppMessage(() => {\r\n                return {\r\n                    title: this.getShareTitle(),\r\n                    imageUrl: this.getShareImgUrl(),\r\n                }\r\n            });\r\n        }\r\n\r\n        if (!this.rewardedVideoAd) {\r\n            this.rewardedVideoAd = wx.createRewardedVideoAd({ adUnitId: 'adunit-3a89cb6497099f0f' })\r\n            this.rewardedVideoAd.onLoad(() => {\r\n                this.isVideoAvailable = true;\r\n            });\r\n            this.rewardedVideoAd.onError(err => {\r\n                console.log(err)\r\n                this.isVideoAvailable = false;\r\n            })\r\n        }\r\n    },\r\n\r\n\r\n    getUserData(callback) {\r\n        console.log(\"USER - getUserData\");\r\n        let _this = this;\r\n        _this.COLLECTION.where({\r\n            _openid: _this.openid\r\n        }).get({\r\n            success(res) {\r\n                // 判断用户是否第一次加入游戏, 查询数据库中是否存在该用户的openId\r\n                if (res.data.length) {\r\n                    data = res.data[0];\r\n                } else {\r\n                    _this.COLLECTION.add({\r\n                        data: {\r\n                            bestScore: 0,\r\n                            loginDays: 0,\r\n                            personCode: 0,\r\n                            playTime: 0,\r\n                            shareTimes: 0,\r\n                            totalScore: 0\r\n                        },\r\n                        success(res) {\r\n                            console.log(\"USER - getUserData: COLLECTION add - success: \");\r\n                            console.log(res);\r\n                        },\r\n                        fail: console.error\r\n                    });\r\n                }\r\n\r\n                _this.DOC = _this.COLLECTION.doc(data._id);  // 如果是微信平台，则要靠 _id 去定位\r\n                console.log(\"USER - getUserData: COLLECTION get - success: \" + _this.DOC);\r\n                callback();\r\n            },\r\n            fail: console.error\r\n        });\r\n    },\r\n\r\n\r\n    navigateToMiniProgram(appId, path) {\r\n        let envVersion = \"release\"; // develop || trial || release;\r\n        wx.navigateToMiniProgram({\r\n            appId,\t// string\t\t是\t要打开的小程序 appId\r\n            path,\t// string\t\t否\t打开的页面路径，如果为空则打开首页\r\n            // extraData:\t// object\t\t否\t需要传递给目标小程序的数据，目标小程序可在 App.onLaunch，App.onShow 中获取到这份数据。\r\n            envVersion, // string\trelease\t否\t要打开的小程序版本。仅在当前小程序为开发版或体验版时此参数有效。如果当前小程序是正式版，则打开的小程序必定是正式版。\r\n            success(){ // function\t\t否\t接口调用成功的回调函数\r\n                console.log(\"跳转成功！\");\r\n            },\t\r\n            fail(){ \t// function\t\t否\t接口调用失败的回调函数\r\n                console.log(\"跳转失败！\");\r\n            },\r\n            complete(){ // function\t\t否\t接口调用结束的回调函数（调用成功、失败都会执行）\r\n                console.log(\"跳转操作完成！\");\r\n            }\t\r\n        });\r\n    },\r\n\r\n    updatePersonCode() {\r\n        let _this = this;\r\n        _this.DOC.update({\r\n            data: {\r\n                personCode: data.personCode\r\n            },\r\n            success: console.log,\r\n            fail: console.error\r\n        })\r\n    },\r\n\r\n    addShareTimes() {\r\n        let _ = this.COMMAND;\r\n        this.DOC.update({\r\n            data: {\r\n                shareTimes: _.inc(1)\r\n            },\r\n            success: console.log,\r\n            fail: console.error\r\n        })\r\n    },\r\n\r\n\r\n    updateThisPlay(playData) {  // 更新当场玩耍数据\r\n        console.log(\"GAMEOVER - Update User Data: \");\r\n        let _this = this;\r\n        let _ = this.COMMAND;\r\n        _this.DOC.update({\r\n            data: {\r\n                playTime: _.inc(playData.thisPlayTime),\r\n                totalScore: _.inc(playData.score),\r\n                bestScore: data.bestScore,\r\n            },\r\n            success: console.log,\r\n            fail: console.error\r\n        });\r\n\r\n        this.saveRankData(data.bestScore);\r\n        console.log(data);\r\n    },\r\n\r\n    saveRankData(bestScore) {\r\n        let openData = [{\r\n            key: 'bestScore',\r\n            value: String(bestScore)\r\n        }];\r\n\r\n        wx.setUserCloudStorage({\r\n            KVDataList: openData,\r\n            success(res) {\r\n                console.log(\"saveOpenData success: \");\r\n                console.log(res);\r\n            },\r\n            fail(res) {\r\n                console.error(\"saveOpenData failed: \");\r\n                console.log(res);\r\n            }\r\n        });\r\n    },\r\n\r\n    share(callback, title) {\r\n        console.log(\"USER - wxShare \");\r\n        let _this = this;\r\n\r\n        wx.shareAppMessage({\r\n            title: title ? title : this.getShareTitle(),\r\n            imageUrl: this.getShareImgUrl(),\r\n            success(res) {\r\n                console.log(res);\r\n                callback();\r\n                wx.showToast({ title: \"分享成功！\", icon: \"none\" });\r\n                _this.addShareTimes();\r\n            },\r\n            fail(res) {\r\n                console.log(res);\r\n                wx.showToast({ title: \"分享失败！\", icon: \"none\" });\r\n            },\r\n        });\r\n    },\r\n\r\n    watchVideoAD(callback) {\r\n        console.log(\"USER-watchVideoAD\")\r\n        // let obj = wx.getSystemInfoSync();\r\n\r\n        if (this.isVideoAvailable) {\r\n            this.rewardedVideoAd.show();\r\n            let onClose = res => {\r\n                if (res) {\r\n                    if (callback) callback(res.isEnded);\r\n                }\r\n                this.rewardedVideoAd.offClose(onClose);\r\n                this.isVideoAvailable = false;\r\n            }\r\n\r\n            this.rewardedVideoAd.onClose(onClose);\r\n        }\r\n    },\r\n\r\n    getShareTitle() {\r\n        let titles = [\r\n            \"谁才是皇牌伐木工？\",\r\n            \" 一起来砍树吧！\",\r\n        ];\r\n        let index = Math.floor(Math.random() * titles.length);\r\n        return titles[index];\r\n    },\r\n    getShareImgUrl() {\r\n        // return `/imgs/timberman-3.6-1.jpg`;\r\n        return `https://gameres.huge7.com/timberman/share.jpg`;\r\n    },\r\n\r\n    sendMeRankData() {\r\n\r\n    },\r\n\r\n    // 排行榜功能： 获得好友在开放数据域的数据\r\n    getRankData() {\r\n\r\n    },\r\n}\r\nWX.__proto__ = local;\r\n\r\n\r\n\r\nfunction USER() {\r\n    if (cc.sys.browserType == cc.sys.BROWSER_TYPE_WECHAT_GAME) {   // 微信游戏平台\r\n        return WX;\r\n    } else if (false) {\r\n        // another platform\r\n\r\n    } else {\r\n        return local;\r\n    }\r\n}\r\n\r\nmodule.exports = USER;"]}